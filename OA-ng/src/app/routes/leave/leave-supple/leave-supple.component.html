<page-header title="补录请假"
             autoBreadcrumb="false">
  补录因某些原因未及时申请请假的假单,补录的假单会直接通过。
</page-header>
<nz-card [nzBordered]="false">
  <form nz-form
        [formGroup]="leaveForm"
        se-container="1"
        labelWidth="200">
    <se label="标题"
        error="请输入标题"
        required>
      <input nz-input
             formControlName="title"
             placeholder="标题尽量简短"
             style="width: 334px;" />
    </se>
    <se label="请假时间"
        error="请假时间必选"
        [optionalHelp]="optionalHelpTpl"
        optional="(全/半)"
        required>
      <ng-template #optionalHelpTpl>
        <button nz-button
                nzType="primary"
                (click)="changeDateType()">点击切换全/半天</button>
      </ng-template>
      <ng-template #halfDay>
        请选完日期后选择上下午！
      </ng-template>
      <ng-container *ngIf="isHalfDay">
        <nz-form-control nzHasFeedback>
          <nz-date-picker nzShowToday="false"
                          (nzOnOk)="(isHalfDay != isHalfDay)"
                          [nzRenderExtraFooter]="halfDay"
                          formControlName="date"
                          [nzDisabledDate]="setDisabledDateRange"></nz-date-picker>
          <nz-form-explain *ngIf="isHalfDay && leaveForm.get('date').dirty && leaveForm.get('date').errors ||
                          leaveForm.get('date')?.pending">
            <ng-container *ngIf="leaveForm.get('date').hasError('required')">
              日期必选！
            </ng-container>
            <ng-container *ngIf="leaveForm.get('date').hasError('sameDayError')">
              <!--  {{leaveForm.get('code').errors['errorName']}} -->历史请假中存在重复的日期！
            </ng-container>
            <ng-container *ngIf="leaveForm.get('date')?.pending">
              正在检测您所选日期是否已申请请假.....
            </ng-container>
          </nz-form-explain>
        </nz-form-control>
        <nz-radio-group style="margin-left: 10px;"
                        formControlName="dateType"
                        (ngModelChange)="changeHalfDay($event)">
          <label nz-radio
                 nzValue="AM">上午</label>
          <label nz-radio
                 nzValue="PM">下午</label>
        </nz-radio-group>

      </ng-container>
      <nz-form-control nzHasFeedback
                       *ngIf="!isHalfDay">
        <nz-range-picker formControlName="date"
                         [nzDisabledDate]="setDisabledDateRange"></nz-range-picker>
        <nz-form-explain *ngIf=" leaveForm.get('date').dirty && leaveForm.get('date').errors ||
        leaveForm.get('date')?.pending">
          <ng-container *ngIf="leaveForm.get('date').hasError('required')">
            日期必选！
          </ng-container>
          <ng-container *ngIf="leaveForm.get('date').hasError('sameDayError')">
            <!--  {{leaveForm.get('code').errors['errorName']}} -->历史请假中存在重复的日期！
          </ng-container>
          <ng-container *ngIf="leaveForm.get('date')?.pending">
            正在检测您所选日期是否已申请请假.....
          </ng-container>
        </nz-form-explain>
      </nz-form-control>
    </se>
    <se label="请假类型"
        error="请假类型必选"
        required>
      <nz-select formControlName="leaveType"
                 nzAllowClear
                 nzPlaceHolder="请选择请假类型"
                 style="width: 334px;">
        <nz-option [nzValue]="type.value"
                   [nzLabel]="type.label"
                   *ngFor="let type of leaveTypeList"></nz-option>
      </nz-select>
    </se>
    <se label="上传图片">
      <nz-upload nzListType="picture-card"
                 nzAction="OA/fileUpload/uploadImg"
                 [(nzFileList)]="imageList"
                 [nzLimit]="0"
                 nzMultiple
                 [nzFilter]="imagefilters"
                 (nzChange)="imgHandleChange($event)"
                 [nzShowUploadList]="showUploadList"
                 [nzPreview]="handlePreview">
        <i nz-icon
           nzType="plus"></i>
        <div class="ant-upload-text">点击上传</div>
      </nz-upload>
      <nz-modal [nzVisible]="previewVisible"
                [nzContent]="modalContent"
                [nzFooter]="null"
                (nzOnCancel)="previewVisible = false">
        <ng-template #modalContent>
          <img [src]="previewImage"
               [ngStyle]="{ width: '100%' }" />
        </ng-template>
      </nz-modal>
    </se>
    <se label="请假原因"
        error="请输入请假原因"
        required>
      <textarea nz-input
                formControlName="reason"
                [nzAutosize]="{ minRows: 4 }"
                placeholder="请尽量详细填写请假原因"></textarea>
    </se>

    <!--     <se label="客户" optionalHelp="目标的服务对象" error="请输入衡量标准">
      <input nz-input formControlName="client" placeholder="请描述你服务的客户，内部客户直接 @姓名／工号" />
    </se> -->
    <!--     <se label="邀评人">
      <input nz-input formControlName="invites" placeholder="请直接 @姓名／工号，最多可邀请 5 人" />
    </se> -->
    <!--     <se label="权重">
      <nz-input-number formControlName="weight" placeholder="请输入"></nz-input-number>
      <em>%</em>
    </se> -->
    <!--     <se label="目标公开" extra="客户、邀评人默认被分享"> 
      <nz-radio-group formControlName="public">
        <label nz-radio [nzValue]="1">公开</label>
        <label nz-radio [nzValue]="2">部分公开</label>
        <label nz-radio [nzValue]="3">不公开</label>
      </nz-radio-group>
      <input *ngIf="leaveForm.value.public === 2" nz-input formControlName="publicUsers" placeholder="公开给" />
    </se> -->
    <se>
      <button nz-button
              nzType="primary"
              [disabled]="leaveForm.invalid"
              type="submit"
              [nzLoading]="submitting"
              (click)="submit(leaveForm.value)">
        提交
      </button>
      <button nz-button
              nzType="primary"
              (click)="leaveForm.reset()">
        重置
      </button>
    </se>
  </form>
  <!--  <nz-row>
    <nz-col> -->

  <!--    </nz-col>
  </nz-row> -->
</nz-card>