<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitware.mapper.LeaveMapper">

    <resultMap id="leaveMap" type="com.bitware.bean.LeaveInfo">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="leave_type" property="leaveType"/>
        <result column="title" property="title"/>
        <result column="begin_time" property="beginTime"/>
        <result column="end_time" property="endTime"/>
        <result column="reason" property="reason"/>
        <result column="order_no" property="orderNo"/>
        <result column="create_time" property="createTime"/>
        <result column="userName" property="userName"/>
        <result column="leaveTypeName" property="leaveTypeName"/>
        <result column="status" property="status"/>
    </resultMap>
    <sql id="baseLeave">
        id,user_id,leave_type,title,begin_time,end_time,reason,order_no,status,create_time
    </sql>
    <select id="getLeaveById" resultMap="leaveMap">
        SELECT
        l.*,
        o.NAME AS leaveTypeName,
        u.NAME AS userName
        FROM
        `leave` l
        LEFT JOIN `user` u ON l.user_id = u.id
        LEFT JOIN ( SELECT di.* FROM dictionary_item di LEFT JOIN dictionary dic ON dic.id = di.dictionary_id AND dic.CODE = 'LeaveType' ) o ON o.CODE = l.leave_type
        <if test="id != null and id != 'all'">
            where id = #{id}
        </if>
    </select>
    <select id="getLeaveByUserId" resultMap="leaveMap">
        SELECT
        l.*,
        o.NAME AS leaveTypeName,
        u.NAME AS userName
        FROM
        `leave` l
        LEFT JOIN `user` u ON l.user_id = u.id
        LEFT JOIN ( SELECT di.* FROM dictionary_item di LEFT JOIN dictionary dic ON dic.id = di.dictionary_id AND dic.CODE = 'LeaveType' ) o ON o.CODE = l.leave_type
        <if test="userId != null and userId != 'all'">
            where l.user_id = #{userId}
        </if>
    </select>
    <insert id="insertLeave">
       INSERT INTO `leave`
       VALUES
       (#{id}, #{userId}, #{leaveType}, #{title},#{beginTime}, #{endTime}, #{reason}, #{orderNo} )
    </insert>
</mapper>